package:
  name: crane
  version: 0.13.0
  epoch: 0
  description: "go container registry crane utility"
  target-architecture:
    - amd64
    - arm64
  copyright:
    - paths:
      - "*"
      license: Apache License 2.0
  dependencies:
    runtime:

environment:
  contents:
    repositories:
      - https://dl-cdn.alpinelinux.org/alpine/edge/main
    packages:
      - alpine-baselayout-data
      - busybox
      - ca-certificates-bundle

pipeline:
  - uses: fetch
    if: ${{build.arch}} == 'x86_64'
    with:
      uri: "https://github.com/google/go-containerregistry/releases/download/v${{package.version}}/go-containerregistry_Linux_x86_64.tar.gz"
      expected-sha256: b06641f6cd08c509d5f1b234076269bfbb512f91e7ba4f796adb8c4b1626c9b7
  - uses: fetch
    if: ${{build.arch}} == 'aarch64'
    with:
      uri: "https://github.com/google/go-containerregistry/releases/download/v${{package.version}}/go-containerregistry_Linux_arm64.tar.gz"
      expected-sha256: b26d322276cf6934a162200a1bde19d9318e4b9656a357527a7465c3bf53f4c2
  - runs: |
      set +x 
      DEST_DIR="${{targets.destdir}}/usr/local/bin"
      mkdir -p "${DEST_DIR}"
      # only if crane package is available
      if [ -f crane ];
      then
        install -Dm755 crane $DEST_DIR/crane
      fi
